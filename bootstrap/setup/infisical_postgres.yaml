---
apiVersion: acid.zalan.do/v1
kind: postgresql
metadata:
  name: infisical-postgres
  namespace: core
spec:
  initContainers:
    - name: init-data-dir
      image: busybox:latest
      cmd: [sh, -c, chown, -R, postgres:root, /home/postgres/pgdata]
  teamId: core
  numberOfInstances: 2
  preparedDatabases:
    infisical:
      defaultUsers: true
  postgresql:
    version: '17'
  volume:
    size: 1Gi
    storageClass: nfs-client
  resources:
    requests:
      cpu: 10m
      memory: 100Mi
    limits:
      cpu: 500m
      memory: 500Mi
